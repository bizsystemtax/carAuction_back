<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="carAucInfDAO">
	
	<resultMap id="CarInfoVO" type="egovframework.carauction.CarInfoVO">
		<result property="rowNum" column="RNUM"/>
		<result property="aucRegNo" column="AUC_REG_NO"/>
		<result property="carNo" column="CAR_NO"/>
		<result property="carModelNm" column="CAR_MODEL_NM"/>
		<result property="carLevelNm" column="CAR_LEVEL_NM"/>
		<result property="aucCarMakeYr" column="AUC_CAR_MAKE_YR"/>
		<result property="fuelType" column="FUEL_TYPE"/>
		<result property="aucCarDrvDis" column="AUC_CAR_DRV_DIS"/>
		<result property="carTransGb" column="CAR_TRANS_GB"/>
		<result property="bidPlnPrice" column="BID_PLN_PRICE"/>
		<result property="bidCnt" column="BID_CNT"/>
		<result property="locImpGb" column="LOC_IMP_GB"/>
		<result property="entryDate" column="ENTRY_DATE"/>
		<result property="bidExpDt" column="BID_EXP_DT"/>
		<result property="entryIdno" column="ENTRY_IDNO"/>
		<result property="bidSdepRt" column="BID_SDEP_RT"/>
	</resultMap>

	<!-- *******************************************************************************************************
	 	차량 경매 정보
	 *******************************************************************************************************-->
	
	<!-- 제조사 목록 조회 -->
	<select id="findAllManufacturers" resultType="hashmap">
		<![CDATA[
			SELECT CODE_HNAME as brHname
			FROM CA_CMM_CD
			WHERE CONCAT(CODE_FIRST, code_second) = 'C01'
			ORDER BY CODE_HNAME
		]]>
	</select>

	<!-- 모델 목록 조회 -->
	<select id="findAllModels" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT CAR_MODEL_NM as modelName
			FROM CA_CAR_INF
			WHERE CAR_MODEL_NM IS NOT NULL AND CAR_MODEL_NM != ''
			ORDER BY CAR_MODEL_NM
		]]>
	</select>

	<!-- 제조사별 모델 목록 조회  -->
	<select id="findModelsByManufacturer" parameterType="String" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT car.CAR_MODEL_NM as modelName
			FROM CA_CAR_INF car
			INNER JOIN CA_CMM_CD cd ON car.MKR_CD = cd.CODE_NO
			WHERE cd.CODE_HNAME = #{manufacturer}
			AND CONCAT(cd.CODE_FIRST, cd.CODE_SECOND) = 'C01'
			AND car.CAR_MODEL_NM IS NOT NULL AND car.CAR_MODEL_NM != ''
			ORDER BY car.CAR_MODEL_NM
		]]>
	</select>

	<!-- 세부모델 목록 조회 -->
	<select id="findAllSubModels" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT CAR_LEVEL_NM as subModelName
			FROM CA_CAR_INF
			WHERE CAR_LEVEL_NM IS NOT NULL AND CAR_LEVEL_NM != ''
			ORDER BY CAR_LEVEL_NM
		]]>
	</select>

	<!-- 제조사+모델별 세부모델 조회 -->
	<select id="findSubModelsByManufacturerAndModel" parameterType="egovframework.carauction.CarSearchCriteriaVO" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT car.CAR_LEVEL_NM as subModelName
			FROM CA_CAR_INF car
			INNER JOIN CA_CMM_CD cd ON car.MKR_CD = cd.CODE_NO
			WHERE 1=1
			AND CONCAT(cd.CODE_FIRST, cd.CODE_SECOND) = 'C01'
			AND car.CAR_LEVEL_NM IS NOT NULL AND car.CAR_LEVEL_NM != ''
		]]>
		
		<if test="manufacturer != null and manufacturer != '' and manufacturer != '전체'">
			AND cd.CODE_HNAME = #{manufacturer}
		</if>
		
		<if test="model != null and model != '' and model != '전체'">
			AND car.CAR_MODEL_NM = #{model}
		</if>
		
		ORDER BY car.CAR_LEVEL_NM
	</select>

	<!-- 연료타입 목록 조회  -->
	<select id="findAllFuelTypes" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT CODE_HNAME as fuelTypeName
			FROM CA_CMM_CD
			WHERE CONCAT(CODE_FIRST, code_second) = 'C04'
			ORDER BY CODE_HNAME
		]]>
	</select>

	<!-- 등록회원사 목록 조회  -->
	<select id="findAllRegistrationCompanies" resultType="hashmap">
		<![CDATA[
			SELECT DISTINCT CODE_HNAME as registrationCompanyName
			FROM CA_CMM_CD
			WHERE CONCAT(CODE_FIRST, CODE_SECOND) = 'U01'
			AND CODE_NO IS NOT NULL
			ORDER BY CODE_NO
		]]>
	</select>

	<!-- 차량 조회 쿼리  -->
	<select id="findCarsWithConditions" parameterType="egovframework.carauction.CarSearchCriteriaVO" resultMap="CarInfoVO">
		<![CDATA[
			SELECT ROW_NUMBER() OVER (ORDER BY auc.ENTRY_DATE DESC) AS RNUM,
			       auc.AUC_REG_NO,
			       auc.CAR_NO,
			       CONCAT(
			           (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = car.MKR_CD AND CONCAT(CODE_FIRST, code_second) = 'C01'),
			           ' ',
			           car.CAR_MODEL_NM
			       ) AS CAR_MODEL_NM,
			       auc.AUC_CAR_CMNT AS CAR_LEVEL_NM,
			       auc.AUC_CAR_MAKE_YR,
			       (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = auc.CAR_ENG_CD AND CONCAT(CODE_FIRST, code_second) = 'C04') AS FUEL_TYPE,
			       auc.AUC_CAR_DRV_DIS,
			       auc.CAR_TRANS_GB,
			       auc.BID_PLN_PRICE,
			       auc.BID_CNT,
			       auc.LOC_IMP_GB,
			       auc.ENTRY_DATE,
			       DATE_FORMAT(STR_TO_DATE(auc.BID_EXP_DT, '%Y%m%d'), '%Y-%m-%d') AS BID_EXP_DT,
			        (SELECT USER_NM
          FROM CA_USER_INF
         WHERE USER_ID = auc.ENTRY_IDNO
       ) AS ENTRY_IDNO,
       CASE 
           WHEN auc.ENTRY_IDNO = #{loginUserId} THEN 'Y'
           ELSE 'N'
       END AS IS_MY_VEHICLE
			FROM CA_CAR_AUC_INF auc
			INNER JOIN CA_CAR_INF car ON auc.CAR_MAIN_NO = car.CAR_MAIN_NO
            AND auc.AUC_PROG_YN = 'Y'
			WHERE 1=1
		]]>
		
		<!-- 제조사 조건 -->
		<if test="manufacturer != null and manufacturer != '' and manufacturer != '전체'">
			AND (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = car.MKR_CD AND CONCAT(CODE_FIRST, code_second) = 'C01') = #{manufacturer}
		</if>

		<!-- 모델 조건 -->
		<if test="model != null and model != '' and model != '전체'">
			AND car.CAR_MODEL_NM = #{model}
		</if>

		<!-- 세부모델 조건 -->
		<if test="subModel != null and subModel != '' and subModel != '전체'">
			AND car.CAR_LEVEL_NM = #{subModel}
		</if>

		<!-- 연료 조건 -->
		<if test="fuelType != null and fuelType != '' and fuelType != '전체'">
			AND (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = car.CAR_ENG_CD AND CONCAT(CODE_FIRST, code_second) = 'C04') = #{fuelType}
		</if>

		<!-- 등록회원사 조건 -->
		<if test="registrationCompany != null and registrationCompany != '' and registrationCompany != '전체'">
			AND (SELECT CODE_HNAME FROM CA_CMM_CD WHERE CODE_NO = auc.ENTRY_IDNO AND CONCAT(CODE_FIRST, CODE_SECOND) = 'U01') = #{registrationCompany}
		</if>

		<!-- 연식 조건 -->
		<if test="startYear != null and startYear != ''">
			AND auc.AUC_CAR_MAKE_YR &gt;= #{startYear}
		</if>
		<if test="endYear != null and endYear != ''">
			AND auc.AUC_CAR_MAKE_YR &lt;= #{endYear}
		</if>

		<!-- 등록일 조건 -->
		<if test="startDate != null and startDate != ''">
			AND auc.ENTRY_DATE &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
			AND auc.ENTRY_DATE &lt;= CONCAT(#{endDate},' 23:59:59')
		</if>

		<!-- 주행거리 조건 -->
		<if test="mileageStart != null and mileageStart != ''">
			AND auc.AUC_CAR_DRV_DIS &gt;= #{mileageStart}
		</if>
		<if test="mileageEnd != null and mileageEnd != ''">
			AND auc.AUC_CAR_DRV_DIS &lt;= #{mileageEnd}
		</if>

		ORDER BY auc.ENTRY_DATE DESC
	</select>
	
	<!-- 차량 상세 정보 조회 (키값 기반) -->
<select id="findCarByAucRegNo" parameterType="String" resultMap="CarInfoVO">
    <![CDATA[
        SELECT ROW_NUMBER() OVER (ORDER BY auc.ENTRY_DATE DESC) AS RNUM,
               auc.AUC_REG_NO,
               auc.CAR_NO,
               CONCAT(
                   (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = car.MKR_CD AND CONCAT(CODE_FIRST, code_second) = 'C01'),
                   ' ',
                   car.CAR_MODEL_NM
               ) AS CAR_MODEL_NM,
               car.CAR_LEVEL_NM,
               auc.AUC_CAR_MAKE_YR,
               (SELECT CODE_HNAME FROM CA_CMM_CD WHERE code_no = car.CAR_ENG_CD AND CONCAT(CODE_FIRST, code_second) = 'C04') AS FUEL_TYPE,
               auc.AUC_CAR_DRV_DIS,
               car.CAR_TRANS_GB,
               auc.BID_PLN_PRICE,
               auc.BID_CNT,
               auc.LOC_IMP_GB,
               auc.ENTRY_DATE,
               DATE_FORMAT(STR_TO_DATE(auc.BID_EXP_DT, '%Y%m%d'), '%Y-%m-%d') AS BID_EXP_DT,
               auc.ENTRY_IDNO,
               auc.BID_SDEP_RT,
               cui.CONT_CELLNO ,
               cui.CONT_EMAIL_ADDR 
        FROM CA_CAR_AUC_INF auc
        LEFT JOIN CA_CAR_INF car ON auc.CAR_MAIN_NO = car.CAR_MAIN_NO
        LEFT join ca_user_inf cui  ON auc.ENTRY_IDNO = cui.USER_ID
        WHERE auc.AUC_REG_NO = #{aucRegNo}
    ]]>
</select>

<!-- 은행 목록 조회 -->
<select id="findAllBanks" resultType="String">
    <![CDATA[
        SELECT DISTINCT MNGR_BANK_NM
        FROM CA_MNGR_ACC_INF
        WHERE MNGR_BANK_NM IS NOT NULL
        AND USE_YN = 'Y'
        ORDER BY MNGR_BANK_NM
    ]]>
</select>

<!-- 은행별 계좌번호 목록 조회 -->
<select id="findAccountsByBank" parameterType="String" resultType="String">
    <![CDATA[
        SELECT MNGR_ACC_NO
        FROM CA_MNGR_ACC_INF
        WHERE MNGR_BANK_NM = #{bankName}
        AND USE_YN = 'Y'
        ORDER BY MNGR_ACC_NO
    ]]>
</select>

<!-- 입찰 순번 조회 (해당 경매번호의 최대 순번 + 1) -->
<select id="getNextBidSeq" parameterType="String" resultType="String">
    SELECT 
        LPAD(IFNULL(MAX(CAST(AUC_REG_SEQ AS UNSIGNED)), 0) + 1, 2, '0') AS next_seq
    FROM 
        CA_CAR_AUC_DTL_BID_INF
    WHERE 
        AUC_REG_NO = #{aucRegNo}
</select>

<select id="checkUserBidHistory" parameterType="java.util.Map" resultType="int">
    SELECT COUNT(*) 
    FROM CA_CAR_AUC_DTL_BID_INF
    WHERE AUC_REG_NO = #{aucRegNo}
      AND ENTRY_IDNO = #{userId}
</select>

<!-- 입찰 순번 조회 -->
<select id="getNextAucRegSeq" parameterType="String" resultType="String">
    SELECT
        LPAD(IFNULL(MAX(CAST(AUC_REG_SEQ AS UNSIGNED)), 0) + 1, 2, '0') AS nextSeq
    FROM
        CA_CAR_AUC_DTL_BID_INF
    WHERE
        AUC_REG_NO = #{aucRegNo}
</select>

<!-- 입찰 등록 -->
<insert id="insertBid" parameterType="java.util.Map">
    INSERT INTO CA_CAR_AUC_DTL_BID_INF (
        AUC_REG_NO
        , AUC_REG_SEQ
        , BIDMN_NM
        , BID_PRICE
        , BID_ENTRY_DATE
        , BID_SDEP_PRICE
        , DEP_BANK_NM
        , DEP_ACC
        , DEPMN_NM
        , AUC_PROG_STAT_CD
        , SBID_YN
        , POM_PAY_YN
        , BIDMN_CELLNO              
        , BIDMN_EMAIL_ADDR
        , ENTRY_DATE
        , ENTRY_IDNO
        , UPDAT_DATE
        , UPDAT_IDNO
    ) VALUES (
        #{aucRegNo}
        , #{aucRegSeq}
        , #{depositorName}
        , #{bidAmount}
        , DATE_FORMAT(NOW(), '%Y%m%d')
        , #{bidSdepPrice}
        , #{bankName}
        , #{accountNumber}
        , #{depositorName}
        , '0010'
        , 'N'
        , 'N'
        , #{contCellNo}            
        , #{contEmailAddr}  
        , NOW()
        , #{entryIdno}
        , NOW()
        , #{updatIdno}
    )
</insert>


<!-- 입찰건수 증가 -->
<update id="incrementBidCount" parameterType="java.util.Map">
    UPDATE CA_CAR_AUC_INF
    SET BID_CNT = IFNULL(BID_CNT, 0) + 1
        , UPDAT_DATE = NOW()
        , UPDAT_IDNO = #{updatIdno}
    WHERE AUC_REG_NO = #{aucRegNo}
</update>

<select id="findUserInfo" parameterType="String" resultType="hashmap">
    <![CDATA[
        SELECT 
            CONT_CELLNO as contCellNo,
            CONT_EMAIL_ADDR as contEmailAddr
        FROM CA_USER_INF
        WHERE USER_ID = #{userId}
    ]]>
</select>
	

	<!-- *******************************************************************************************************
	 	차량 판매 정보
	 ******************************************************************************************************* -->
	 	
	 <!-- 오늘 날짜 기준으로 다음 ID 조회 -->
	 <select id="getNextId" resultType="string">
     SELECT 
            CONCAT(DATE_FORMAT(NOW(), '%y%m%d')
          , LPAD(IFNULL(MAX(CAST(SUBSTRING(AUC_REG_NO, 7, 4) AS UNSIGNED)), 0) + 1, 4, '0')) AS new_id
       FROM 
            CA_CAR_AUC_INF
      WHERE 
            AUC_REG_NO LIKE CONCAT(DATE_FORMAT(NOW(), '%y%m%d'), '%')
	 </select>
	 	 
	 <select id="manufacturList" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
		    CODE_NO as CODE_NO
	      , CODE_HNAME as CODE_HNAME
	   FROM 
	        CA_CMM_CD
	  WHERE 
	        CODE_KITA5 = #{codeKita5} 
	    AND CODE_USEYN = 'Y' -- 사용여부(Y/N)
	    AND CODE_FIRST = #{codeFirst} 
	    AND CODE_SECOND = #{codeSecond}  
		
	 </select>
	
	 <select id="modNmList" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
		    CAR_MODEL_CD as CODE_NO
		  , CAR_MODEL_NM as CODE_HNAME
	   FROM 
	        CA_CAR_INF
	  WHERE 
	        MKR_CD = #{mkrCd} -- 제조사코드(메이커코드)
			GROUP BY CAR_MODEL_CD -- 모델코드

	 </select>
	
	 <select id="grdNmList" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
		    CAR_LEVEL_CD as CODE_NO
		  , CAR_LEVEL_NM as CODE_HNAME
	   FROM 
	        CA_CAR_INF
	  WHERE 
	        MKR_CD = #{mkrCd} -- 제조사코드(메이커코드)
	    AND CAR_MODEL_CD = #{carModelCd} -- 모델코드
		AND REP_CAR_YN = 'Y' -- 대표차량
   GROUP BY CAR_LEVEL_CD -- 모델코드
	 </select>
	
	 <select id="dtlGrdNmList" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
		    CAR_DT_LEVEL_CD as CODE_NO
		  , IFNULL(CAR_DT_LEVEL_NM,'-') as CODE_HNAME
	   FROM 
	        CA_CAR_INF
	  WHERE 
	        MKR_CD = #{mkrCd} -- 제조사코드(메이커코드)
		AND CAR_MODEL_CD = #{carModelCd} -- 모델코드
		AND CAR_LEVEL_CD = #{carLevelCd} -- 등급코드
   GROUP BY CAR_DT_LEVEL_CD -- 세부등급코드
	 </select>
	
	 <select id="getCarAucInfo" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
		    ca_cmm_cd.CODE_HNAME
		  , ca_car_inf.CAR_MAIN_NO
		  , ca_car_inf.CAR_CC
		  , ca_car_inf.CAR_ENG_CD
		  , ca_car_inf.CAR_PRICE
		  , ca_car_inf.CAR_TRANS_GB
	   FROM 
		    ca_car_inf
     LEFT OUTER JOIN ca_cmm_cd
			      ON ca_cmm_cd.CODE_NO = ca_car_inf.CAR_ENG_CD 
				 AND ca_cmm_cd.CODE_USEYN = 'Y'  
				 AND ca_cmm_cd.CODE_FIRST = #{codeFirst}  
				 AND ca_cmm_cd.CODE_SECOND = #{codeSecond}
		       WHERE ca_car_inf.MKR_CD = #{mkrCd} -- 제조사코드(메이커코드)
		        AND ca_car_inf.CAR_MODEL_CD = #{carModelCd} -- 모델코드
		        AND ca_car_inf.CAR_LEVEL_CD = #{carLevelCd} -- 등급코드
		        AND ca_car_inf.CAR_DT_LEVEL_CD = #{carDtLevelCd} -- 세부등급코드
	 </select>
	
	 <select id="getCarEngCd" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleVO">
	 SELECT 
			CODE_NO as CODE_NO
		  , CODE_HNAME as CODE_HNAME
	   FROM 
	        CA_CMM_CD
	  WHERE 
	        CODE_USEYN = 'Y' -- 사용여부(Y/N)
	    AND CODE_FIRST = 'C'
		AND CODE_SECOND = '04' 

	 </select>
	
	 <insert id="insertCarSale" parameterType="egovframework.carauction.CarSaleDetailVO">
	 INSERT INTO CA_CAR_AUC_INF (
								  AUC_REG_NO
								, CAR_MAIN_NO
								, LOC_IMP_GB
								, CAR_ENG_CD
								, AUC_CAR_CC
								, CAR_TRANS_GB
								, AUC_CAR_SEAT
								, CAR_PRICE
								, CAR_NO
								, AUC_CAR_CMNT
								, AUC_CAR_MAKE_YR
								, AUC_CAR_DRV_DIS
								, BID_PLN_PRICE
								, BID_SDEP_RT
								, BID_EXP_DT
								, EOM_YN
								, EOM_PRICE
								, AUC_PROG_STAT_CD
								, ENTRY_IDNO
								, UPDAT_IDNO
		               ) VALUES (
								  #{aucRegNo}
								, #{carMainNo}
								, #{locImpGb}
								, #{carEngCd}
								, #{aucCarCc}
								, #{carTransGb}
								, #{aucCarSeat}
								, #{carPrice}
								, #{carNo}
								, #{aucCarCmnt}
								, #{aucCarMakeYr}
								, #{aucCarDrvDis}
								, #{bidPlnPrice}
								, #{bidSdepRt}
								, #{bidExpDt}
								, #{eomYn}
								, #{eomPrice}
								, #{aucProgStatCd}
								, #{entryIdno}
								, #{updatIdno}
		)
	 </insert>
	 
	 <select id="getCarSaleDetail" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleDetailVO">
	 SELECT
			A.AUC_REG_NO
		  , A.CAR_MAIN_NO
		  , A.LOC_IMP_GB
		  , A.CAR_ENG_CD
		  , A.AUC_CAR_CC
		  , A.CAR_TRANS_GB
		  , A.AUC_CAR_SEAT
		  , A.CAR_PRICE
		  , A.CAR_NO
		  , A.AUC_CAR_CMNT
		  , A.AUC_CAR_MAKE_YR
		  , A.AUC_CAR_DRV_DIS
		  , A.BID_PLN_PRICE
		  , A.BID_SDEP_RT
		  , A.BID_EXP_DT
		  , A.EOM_YN
		  , A.EOM_PRICE
		  , A.BID_CNT
		  , A.AUC_PROG_STAT_CD
		  , A.AUC_PROG_YN
		  , A.SBID_PRICE
		  , A.SBID_DATE
		  , A.SBIDMN_NM
		  , A.ENTRY_DATE
		  , A.ENTRY_IDNO
		  , A.UPDAT_DATE
		  , A.UPDAT_IDNO
		  , B.MKR_CD
		  , B.CAR_MODEL_CD
		  , B.CAR_LEVEL_CD
		  , B.CAR_DT_LEVEL_CD
	   FROM
		    CA_CAR_AUC_INF A
		    LEFT OUTER JOIN CA_CAR_INF B
		    ON A.CAR_MAIN_NO = B.CAR_MAIN_NO
	  WHERE 
            AUC_REG_NO = #{aucRegNo}
	 </select>
	 
	 <select id="getCarSaleImgDetail" parameterType="egovframework.carauction.CarSaleVO" resultType="egovframework.carauction.CarSaleDetailVO">
	 SELECT
		    ATT_FILE_NM
		  , ATT_FILE_SIZE
		  , ATT_FILE_PATH
		  , ATT_FILE_TYPE
		  , FILE_SEQ
		  , FILE_SVR_NAME
	   FROM
		    CA_ATT_FILE
	  WHERE 
            TARGET_ID = #{aucRegNo}
	 </select>
	 
	 <select id="getFileInfo" parameterType="egovframework.carauction.CarSaleDetailVO" resultType="egovframework.carauction.CarSaleDetailVO">
	 SELECT
		    ATT_FILE_NM
		  , ATT_FILE_SIZE
		  , ATT_FILE_PATH
		  , ATT_FILE_TYPE
		  , FILE_SEQ
		  , FILE_SVR_NAME
	   FROM
		    CA_ATT_FILE
	  WHERE 
            TARGET_ID = #{aucRegNo}
			AND FILE_SEQ  = #{fileSeq}
	 </select>  
	 
	<update id="updateCarSale" parameterType="egovframework.carauction.CarSaleDetailVO">
    UPDATE 
           CA_CAR_AUC_INF 
       SET
           CAR_MAIN_NO = #{carMainNo}
         , LOC_IMP_GB = #{locImpGb}
         , CAR_ENG_CD = #{carEngCd}
         , AUC_CAR_CC = #{aucCarCc}
         , CAR_TRANS_GB = #{carTransGb}
         , AUC_CAR_SEAT = #{aucCarSeat}
         , CAR_PRICE = #{carPrice}
         , CAR_NO = #{carNo}
         , AUC_CAR_CMNT = #{aucCarCmnt}
         , AUC_CAR_MAKE_YR = #{aucCarMakeYr}
         , AUC_CAR_DRV_DIS = #{aucCarDrvDis}
         , BID_PLN_PRICE = #{bidPlnPrice}
         , BID_SDEP_RT = #{bidSdepRt}
         , BID_EXP_DT = #{bidExpDt}
         , EOM_YN = #{eomYn}
         , EOM_PRICE = #{eomPrice}
         , UPDAT_DATE = CURRENT_TIMESTAMP
         , UPDAT_IDNO = #{updatIdno}
     WHERE 
           AUC_REG_NO = #{aucRegNo}
    </update>

	<update id="deleteCarSale" parameterType="egovframework.carauction.CarSaleDetailVO">
    DELETE 
      FROM
           CA_CAR_AUC_INF 
     WHERE 
           AUC_REG_NO = #{aucRegNo}
    </update>
    
    <update id="deleteCarSaleImgInfo" parameterType="egovframework.carauction.CarSaleDetailVO">
    DELETE 
      FROM
           CA_ATT_FILE
     WHERE 
           TARGET_ID = #{aucRegNo}
    </update>
    
</mapper>