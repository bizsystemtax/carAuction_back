<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserInfDAO">
	<resultMap id="UserInfVO" type="egovframework.carauction.UserInfVO">
		<!-- 회원관리 목록 조회 파라미터 -->
		<result property="inStartDate" column="IN_START_DATE"/>
		<result property="inEndDate" column="IN_END_DATE"/>
		<result property="inUserGbCd" column="IN_USER_GB_CD"/>
		<result property="inUserNm" column="IN_USER_NM"/>
		<result property="num" column="NUM"/>
		<result property="userGbNm" column="USER_GB_NM"/>
		<result property="userNm" column="USER_NM"/>
		<result property="contNm" column="CONT_NM"/>
		<result property="contCellno" column="CONT_CELLNO"/>
		<result property="compAddr" column="COMP_ADDR"/>
		<result property="compTelno" column="COMP_TELNO"/>
		<result property="aucEntryCnt" column="AUC_ENTRY_CNT"/>
		<result property="aucBidProgCnt" column="AUC_BID_PROG_CNT"/>
		<result property="aucSbidCnt" column="AUC_SBID_CNT"/>
		<result property="bidEntryCnt" column="BID_ENTRY_CNT"/>
		<result property="bidSbidCnt" column="BID_SBID_CNT"/>
		<result property="regDate" column="REG_DATE"/>
		
		<!-- 필수 파라미터 -->
		<result property="sessionId" column="SESSION_ID"/>
		<result property="sessionIp" column="SESSION_IP"/>
	</resultMap>
	
	<!-- Retrieve : 회원관리 목록 조회 -->
	<select id="userInfListSelect" parameterType="egovframework.carauction.UserInfVO" resultMap="UserInfVO">
		<![CDATA[
		select ROW_NUMBER() OVER (ORDER BY A.ENTRY_DATE desc, A.USER_ID DESC) AS NUM /* 순번 */
		     , (
		        select CMM.CODE_HNAME
		        from   CA_CMM_CD CMM
		        where  CMM.CODE_FIRST = 'U'
		        and    CMM.CODE_SECOND = '01'
		        and    CMM.CODE_NO = A.USER_GB_CD
		        ) as USER_GB_NM /* 사용자구분명 */
		     , A.USER_NM as USER_NM /* 사용자명 */
		     , A.CONT_NM as CONT_NM /* 담당자명 */
		     , A.CONT_CELLNO as CONT_CELLNO /* 담당자 휴대전화번호 */
		     , A.COMP_ADDR as COMP_ADDR /* 회사주소 */
		     , A.COMP_TELNO as COMP_TELNO /* 회사전화번호 */
		     , (
		        select COUNT(1)
		        from   CA_CAR_AUC_INF CAI
		        where  CAI.ENTRY_IDNO = A.USER_ID
		        ) as AUC_ENTRY_CNT /* 경매등록건수 */
		     , (
		        select COUNT(1)
		        from   CA_CAR_AUC_INF CAI
		        where  CAI.ENTRY_IDNO = A.USER_ID
		        and    CAI.AUC_PROG_YN = 'Y'
		        ) as AUC_BID_PROG_CNT /* 경매입찰진행건수 */
		     , (
		        select COUNT(1)
		        from   CA_CAR_AUC_INF CAI
		        where  CAI.ENTRY_IDNO = A.USER_ID
		        and    CAI.SBID_DATE is not NULL
		        ) as AUC_SBID_CNT /* 경매낙찰건수 */
		     , (
		        select COUNT(1)
		        from   CA_CAR_AUC_DTL_BID_INF CAD
		        where  CAD.ENTRY_IDNO = A.USER_ID
		        ) as BID_ENTRY_CNT /* 입찰등록건수 */
		     , (
		        select COUNT(1)
		        from   CA_CAR_AUC_DTL_BID_INF CAD
		        where  CAD.ENTRY_IDNO = A.USER_ID
		        and    CAD.SBID_YN = 'Y'
		        ) as BID_SBID_CNT /* 입찰낙찰건수 */
		     , TO_CHAR(A.ENTRY_DATE, 'YYYYMMDD') AS REG_DATE /* 가입일자 */
		from   CA_USER_INF A /* 회원관리 */
		where  A.USER_ID IS NOT NULL
		]]>
		<!-- 가입일자기간 -->
		<if test="inStartDate != null and inStartDate != '' and inEndDate != null and inEndDate != ''">
		AND	TO_CHAR(A.ENTRY_DATE, 'YYYYMMDD') BETWEEN #{inStartDate} AND #{inEndDate}
		</if>
		<!-- 회원구분 -->
		<if test="inUserGbCd != null and inUserGbCd != ''">
		AND A.USER_GB_CD IN (#{inUserGbCd})
		</if>
		<!-- 회원명 -->
		<if test="inUserNm != null and inUserNm != ''">
		AND A.USER_NM LIKE '%' || #{inUserNm} || '%'
		</if>
		ORDER BY NUM
	</select>
</mapper>