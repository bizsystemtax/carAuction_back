<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MyPageDAO">
	
	<resultMap id="MyPageVO" type="egovframework.carauction.MyPageVO">
	  	<result property = "codeFirst"		    column = "CODE_FIRST"/>
	  	<result property = "codeSecond"		    column = "CODE_SECOND"/>
	  	<result property = "codeNo"		        column = "CODE_NO"/>
	  	<result property = "codeHname"		    column = "CODE_HNAME"/>
	  	<result property = "codeKita1"		    column = "CODE_KITA1"/>
	  	<result property = "codeKita2"		    column = "CODE_KITA2"/>
	  	<result property = "codeKita3"		    column = "CODE_KITA3"/>
	  	<result property = "codeKita4"		    column = "CODE_KITA4"/>
	  	<result property = "codeKita5"		    column = "CODE_KITA5"/>
	  	<result property = "codeUseyn"		    column = "CODE_USEYN"/>
	  	<result property = "sortOrder"		    column = "SORT_ORDER"/>
	  	<result property = "mkrCd"		        column = "MKR_CD"/>
	  	<result property = "carModelCd"		    column = "CAR_MODEL_CD"/>
	  	<result property = "carModelNm"		    column = "CAR_MODEL_NM"/>
	  	<result property = "repCarYn"		    column = "REP_CAR_YN"/>
	  	<result property = "carLevelCd"		    column = "CAR_LEVEL_CD"/>
	  	<result property = "carLevelNm"		    column = "CAR_LEVEL_NM"/>
	 	<result property = "carDtLevelCd"	    column = "CAR_DT_LEVEL_CD"/>
	  	<result property = "carDtLevelName"	  	column = "CAR_DT_LEVEL_NAME"/>
	  	<result property = "carKindCd"		    column = "CAR_KIND_CD"/>
	  	<result property = "makeStrtYrMn"		column = "MAKE_STRT_YR_MN"/>
		<result property = "makeEndYrMn"		column = "MAKE_END_YR_MN"/>
		<result property = "carCc"		        column = "CAR_CC"/>
		<result property = "useYn"		        column = "USE_YN"/>
		<result property = "aucCarCc"		    column = "AUC_CAR_CC"/>
		<result property = "aucCarSeat"		    column = "AUC_CAR_SEAT"/>
		<result property = "carNo"		        column = "CAR_NO"/>
		<result property = "aucCarCmnt"		    column = "AUC_CAR_CMNT"/>
		<result property = "aucCarMakeYr"		column = "AUC_CAR_MAKE_YR"/>
		<result property = "aucCarDrvDis"		column = "AUC_CAR_DRV_DIS"/>
		<result property = "bidPlnPrice"		column = "BID_PLN_PRICE"/>
		<result property = "bidExpDt"		    column = "BID_EXP_DT"/>
		<result property = "eomYn"		        column = "EOM_YN"/>
		<result property = "eomPrice"		    column = "EOM_PRICE"/>
		<result property = "bidCnt"		        column = "BID_CNT"/>
		<result property = "aucProgYn"		    column = "AUC_PROG_YN"/>
		<result property = "sbidmnNm"		    column = "SBIDMN_NM"/>
		<result property = "aucRegSeq"		    column = "AUC_REG_SEQ"/>
		<result property = "bidmnNm"		    column = "BIDMN_NM"/>
		<result property = "bidmnCellno"		column = "BIDMN_CELLNO"/>
		<result property = "bidmnEmailAddr"	  	column = "BIDMN_EMAIL_ADDR"/>
		<result property = "bidPrice"		    column = "BID_PRICE"/>
		<result property = "bidEntryDate"		column = "BID_ENTRY_DATE"/>
		<result property = "depBankNm"		    column = "DEP_BANK_NM"/>
		<result property = "depAcc"		        column = "DEP_ACC"/>
		<result property = "depmnNm"		    column = "DEPMN_NM"/>
		<result property = "aucProgStatCd"		column = "AUC_PROG_STAT_CD"/>
		<result property = "sbidYn"		        column = "SBID_YN"/>
		<result property = "pomPayYn"		    column = "POM_PAY_YN"/>
		<result property = "carPrice"		    column = "CAR_PRICE"/>
		<result property = "carMainNo"		    column = "CAR_MAIN_NO"/>
		<result property = "locImpGb"		    column = "LOC_IMP_GB"/>
		<result property = "carEngCd"		    column = "CAR_ENG_CD"/>
		<result property = "carTransGb"		    column = "CAR_TRANS_GB"/>
		<result property = "aucRegNo"		    column = "AUC_REG_NO"/>
		<result property = "bidSdepPrice"		column = "BID_SDEP_PRICE"/>
		<result property = "sbidPrice"	     	column = "SBID_PRICE"/>
		<result property = "sbidDate"		    column = "SBID_DATE"/>
		<result property = "entryDate"		    column = "ENTRY_DATE"/>
		<result property = "entryIdno"		    column = "ENTRY_IDNO"/>
		<result property = "updatDate"		    column = "UPDAT_DATE"/>
		<result property = "updatIdno"		    column = "UPDAT_IDNO"/>
		<result property = "regStrDt"		    column = "REG_STR_DT"/>
		<result property = "regEndDt"		    column = "REG_END_DT"/>
		<result property = "proState"		    column = "PRO_STATE"/>
		<result property = "fuelType"			column = "FUEL_TYPE"/>
		<result property = "carTransNm"			column = "CAR_TRANS_NM"/>
		<result property = "aucProgStatNm"		column = "AUC_PROG_STAT_NM"/>
		<result property = "fromDt"				column = "fromDt"/>
		<result property = "toDt"				column = "toDt"/>
		<result property = "RNUM"				column = "RNUM"/>
		
	</resultMap>
	
	<!-- 콤보박스 진행상태 조회 -->
	<select id="comboBoxList" parameterType="egovframework.carauction.MyPageVO" resultType="egovframework.carauction.MyPageVO">
		<![CDATA[
			SELECT CODE_NO    /*코드번호*/
			     , CODE_HNAME /*코드명*/
			  FROM CA_CMM_CD 
		 	WHERE CODE_USEYN = 'Y'
		  	 AND CONCAT(CODE_FIRST, CODE_SECOND) = 'S01'
		]]>

	</select>
	
	<!-- 마이페이지 - 내 판매차량 입찰 상세 현황 -->
	<select id="myPageList" parameterType="egovframework.carauction.MyPageVO" resultType="egovframework.carauction.MyPageVO">
	<![CDATA[
		SELECT ROW_NUMBER() OVER (ORDER BY CCAI.ENTRY_DATE DESC) AS RNUM
		     , CCAI.AUC_REG_NO  /*경매등록번호*/
		     , CCAI.CAR_MAIN_NO /*차량관리번호*/
		     , CCAI.CAR_NO      /*차량번호*/
		     , CONCAT((SELECT CODE_HNAME FROM CA_CMM_CD WHERE CODE_NO = CCI.MKR_CD AND CONCAT(CODE_FIRST, CODE_SECOND) = 'C01'), ' ', CCI.CAR_MODEL_NM) AS CAR_MODEL_NM /*차량명*/
		     , CCAI.AUC_CAR_MAKE_YR /*연식*/
		     , (SELECT CODE_HNAME FROM CA_CMM_CD WHERE CODE_NO = CCAI.CAR_ENG_CD AND CONCAT(CODE_FIRST, CODE_SECOND) = 'C04') AS FUEL_TYPE /*연료*/
		     , FORMAT(CCAI.AUC_CAR_DRV_DIS, 0) AS AUC_CAR_DRV_DIS /*주행거리*/
		     , CCAI.CAR_TRANS_GB     /*변속기 구분*/
		     , CASE WHEN CCAI.CAR_TRANS_GB = 'A' THEN '오토'
		       ELSE '수동'
		        END AS CAR_TRANS_NM /*변속기명*/
		     , FORMAT(CCAI.BID_PLN_PRICE, 0) AS BID_PLN_PRICE   /*입찰예정금액*/
		     , CCAI.BID_CNT         /*입찰건수*/
		     , DATE_FORMAT(CCAI.ENTRY_DATE, '%Y-%m-%d') AS ENTRY_DATE /*등록일*/
		     , (SELECT CODE_NO FROM CA_CMM_CD WHERE CODE_NO = CCAI.AUC_PROG_STAT_CD AND CONCAT(CODE_FIRST, CODE_SECOND) = 'S01') AS AUC_PROG_STAT_CD /*진행상태코드*/
		     /*, (SELECT CODE_HNAME FROM CA_CMM_CD WHERE CODE_NO = CCAI.AUC_PROG_STAT_CD AND CONCAT(CODE_FIRST, CODE_SECOND) = 'S01') AS AUC_PROG_STAT_NM 진행상태명*/
		     , CASE WHEN CCAI.AUC_PROG_STAT_CD = '0010' THEN '경매진행중'
			        WHEN CCAI.AUC_PROG_STAT_CD = '0020' AND CCAI.AUC_PROG_YN = 'Y' AND CCAI.SBID_PRICE != 0 THEN '본인낙찰'
				    WHEN CCAI.AUC_PROG_STAT_CD = '0020' AND  CCAI.AUC_PROG_YN = 'Y' AND CCAI.SBID_PRICE = 0 THEN '제3자 낙찰'
				    WHEN CCAI.AUC_PROG_STAT_CD = '0020' THEN '낙찰'
				    WHEN CCAI.AUC_PROG_STAT_CD = '0030' THEN '낙찰금액완납'
				    WHEN CCAI.AUC_PROG_STAT_CD = '0040' THEN '명의이전완료'
				    WHEN CCAI.AUC_PROG_STAT_CD = '0050' THEN '유찰'
			   ELSE ''
			    END AS AUC_PROG_STAT_NM /*진행상태명*/
		     , FORMAT(CCAI.SBID_PRICE, 0) AS SBID_PRICE /*낙찰금액*/
		     , CCAI.SBID_DATE  /*낙찰일*/
		     , CCAI.ENTRY_IDNO /*낙찰 회원사명*/
		     , CCAI.AUC_PROG_YN /*진행상태 여부*/
		  FROM CA_CAR_AUC_INF CCAI 
		 INNER JOIN CA_CAR_INF CCI 
		    ON CCAI.CAR_MAIN_NO = CCI.CAR_MAIN_NO 
		 WHERE CCAI.ENTRY_DATE BETWEEN #{regStrDt} AND #{regEndDt}  
	]]>
		<if test="proState != null and proState != ''">
		   AND CCAI.AUC_PROG_STAT_CD = #{proState} 
		</if> 
	</select>
</mapper>